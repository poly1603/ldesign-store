# æ€§èƒ½æµ‹è¯•æ–‡æ¡£

æœ¬ç›®å½•åŒ…å«äº†å®Œæ•´çš„æ€§èƒ½æµ‹è¯•å¥—ä»¶ï¼Œç”¨äºç›‘æ§å’ŒéªŒè¯ Vue 3 + TypeScript + Pinia é¡¹ç›®çš„æ€§èƒ½è¡¨ç°ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
tests/performance/
â”œâ”€â”€ setup.ts                           # æ€§èƒ½æµ‹è¯•åŸºç¡€å·¥å…·å’Œé…ç½®
â”œâ”€â”€ store-performance.test.ts           # Store çŠ¶æ€æ›´æ–°æ€§èƒ½æµ‹è¯•
â”œâ”€â”€ rendering-performance.test.ts       # å¤§æ•°æ®é‡æ¸²æŸ“æ€§èƒ½æµ‹è¯•
â”œâ”€â”€ debounce-throttle-performance.test.ts # é˜²æŠ–å’ŒèŠ‚æµåŠŸèƒ½æ€§èƒ½æµ‹è¯•
â”œâ”€â”€ cache-performance.test.ts           # ç¼“å­˜æœºåˆ¶æ€§èƒ½æµ‹è¯•
â”œâ”€â”€ benchmark.test.ts                   # æ€§èƒ½åŸºå‡†æµ‹è¯•å’Œå›å½’æ£€æµ‹
â”œâ”€â”€ performance-baseline.json           # æ€§èƒ½åŸºå‡†æ•°æ®ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ results.json                        # æµ‹è¯•ç»“æœï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â””â”€â”€ README.md                          # æœ¬æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ‰€æœ‰æ€§èƒ½æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æ€§èƒ½æµ‹è¯•
pnpm test:performance

# ä½¿ç”¨ UI ç•Œé¢è¿è¡Œæ€§èƒ½æµ‹è¯•
pnpm test:performance:ui

# è¿è¡ŒåŸºå‡†æµ‹è¯•
pnpm test:benchmark

# å»ºç«‹æ€§èƒ½åŸºå‡†çº¿
pnpm test:benchmark:baseline
```

### è¿è¡Œç‰¹å®šæµ‹è¯•

```bash
# Store æ€§èƒ½æµ‹è¯•
vitest tests/performance/store-performance.test.ts

# æ¸²æŸ“æ€§èƒ½æµ‹è¯•
vitest tests/performance/rendering-performance.test.ts

# é˜²æŠ–èŠ‚æµæ€§èƒ½æµ‹è¯•
vitest tests/performance/debounce-throttle-performance.test.ts

# ç¼“å­˜æ€§èƒ½æµ‹è¯•
vitest tests/performance/cache-performance.test.ts
```

## ğŸ“Š æµ‹è¯•ç±»å‹è¯¦è§£

### 1. Store çŠ¶æ€æ›´æ–°æ€§èƒ½æµ‹è¯• (`store-performance.test.ts`)

æµ‹è¯• Pinia Store çš„å„ç§æ“ä½œæ€§èƒ½ï¼š

- **å•ä¸ªçŠ¶æ€æ›´æ–°æ€§èƒ½**: æµ‹è¯•å•ä¸ªäº§å“çš„å¢åˆ æ”¹æŸ¥æ“ä½œ
- **æ‰¹é‡çŠ¶æ€æ›´æ–°æ€§èƒ½**: æµ‹è¯•å¤§é‡æ•°æ®çš„æ‰¹é‡æ“ä½œ
- **æ·±å±‚å¯¹è±¡æ›´æ–°æ€§èƒ½**: æµ‹è¯•åµŒå¥—å¯¹è±¡çš„æ›´æ–°æ€§èƒ½
- **è·¨ Store æ“ä½œæ€§èƒ½**: æµ‹è¯•å¤šä¸ª Store åŒæ—¶æ“ä½œçš„æ€§èƒ½

**æ€§èƒ½æŒ‡æ ‡**:
- æ“ä½œé¢‘ç‡ (ops/sec): æ¯ç§’å¯æ‰§è¡Œçš„æ“ä½œæ¬¡æ•°
- å¹³å‡æ‰§è¡Œæ—¶é—´ (ms): å•æ¬¡æ“ä½œçš„å¹³å‡è€—æ—¶
- å†…å­˜ä½¿ç”¨é‡ (MB): æ“ä½œè¿‡ç¨‹ä¸­çš„å†…å­˜æ¶ˆè€—

### 2. å¤§æ•°æ®é‡æ¸²æŸ“æ€§èƒ½æµ‹è¯• (`rendering-performance.test.ts`)

æµ‹è¯• Vue ç»„ä»¶åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶çš„æ¸²æŸ“æ€§èƒ½ï¼š

- **å¤§åˆ—è¡¨æ¸²æŸ“æ€§èƒ½**: æµ‹è¯•æ¸²æŸ“ 1000+ åˆ—è¡¨é¡¹çš„æ€§èƒ½
- **è™šæ‹Ÿæ»šåŠ¨æ€§èƒ½**: æµ‹è¯•è™šæ‹Ÿæ»šåŠ¨ç»„ä»¶çš„æ€§èƒ½ä¼˜åŒ–æ•ˆæœ
- **åŠ¨æ€æ›´æ–°æ€§èƒ½**: æµ‹è¯•æ•°æ®å˜åŒ–æ—¶çš„é‡æ¸²æŸ“æ€§èƒ½
- **ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ€§èƒ½**: æµ‹è¯•ç»„ä»¶æŒ‚è½½å’Œå¸è½½çš„æ€§èƒ½

**æ€§èƒ½æŒ‡æ ‡**:
- é¦–æ¬¡æ¸²æŸ“æ—¶é—´ (ms): ç»„ä»¶é¦–æ¬¡æŒ‚è½½çš„è€—æ—¶
- æ›´æ–°æ¸²æŸ“æ—¶é—´ (ms): æ•°æ®æ›´æ–°åçš„é‡æ¸²æŸ“è€—æ—¶
- å†…å­˜å ç”¨ (MB): æ¸²æŸ“è¿‡ç¨‹ä¸­çš„å†…å­˜ä½¿ç”¨

### 3. é˜²æŠ–å’ŒèŠ‚æµåŠŸèƒ½æ€§èƒ½æµ‹è¯• (`debounce-throttle-performance.test.ts`)

æµ‹è¯•é˜²æŠ–å’ŒèŠ‚æµå‡½æ•°çš„æ€§èƒ½å’Œæ­£ç¡®æ€§ï¼š

- **é˜²æŠ–å‡½æ•°æ€§èƒ½**: æµ‹è¯•ä¸åŒå»¶è¿Ÿæ—¶é—´çš„é˜²æŠ–æ€§èƒ½
- **èŠ‚æµå‡½æ•°æ€§èƒ½**: æµ‹è¯•ä¸åŒé—´éš”æ—¶é—´çš„èŠ‚æµæ€§èƒ½
- **é«˜é¢‘è°ƒç”¨åœºæ™¯**: æµ‹è¯•æé«˜é¢‘è°ƒç”¨ä¸‹çš„æ€§èƒ½è¡¨ç°
- **å†…å­˜æ³„æ¼æ£€æµ‹**: æ£€æµ‹å®šæ—¶å™¨æ¸…ç†æ˜¯å¦æ­£ç¡®

**æ€§èƒ½æŒ‡æ ‡**:
- å‡½æ•°åˆ›å»ºæ€§èƒ½ (ops/sec): åˆ›å»ºé˜²æŠ–/èŠ‚æµå‡½æ•°çš„é€Ÿåº¦
- è°ƒç”¨æ‰§è¡Œæ€§èƒ½ (ops/sec): å‡½æ•°è°ƒç”¨çš„æ‰§è¡Œé€Ÿåº¦
- å†…å­˜ä½¿ç”¨ç¨³å®šæ€§: é•¿æ—¶é—´è¿è¡Œåçš„å†…å­˜å˜åŒ–

### 4. ç¼“å­˜æœºåˆ¶æ€§èƒ½æµ‹è¯• (`cache-performance.test.ts`)

æµ‹è¯•ç¼“å­˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå‘½ä¸­ç‡ï¼š

- **ç¼“å­˜è¯»å†™æ€§èƒ½**: æµ‹è¯•ç¼“å­˜çš„åŸºæœ¬è¯»å†™æ“ä½œæ€§èƒ½
- **ç¼“å­˜å‘½ä¸­ç‡æµ‹è¯•**: éªŒè¯ç¼“å­˜çš„å‘½ä¸­ç‡å’Œæ€§èƒ½æå‡
- **LRU ç¼“å­˜æ€§èƒ½**: æµ‹è¯• LRU æ·˜æ±°ç­–ç•¥çš„æ€§èƒ½
- **å†…å­˜ä½¿ç”¨ä¼˜åŒ–**: æµ‹è¯•ç¼“å­˜çš„å†…å­˜ä½¿ç”¨æ•ˆç‡

**æ€§èƒ½æŒ‡æ ‡**:
- ç¼“å­˜å‘½ä¸­ç‡ (%): ç¼“å­˜å‘½ä¸­çš„ç™¾åˆ†æ¯”
- è¯»å†™é€Ÿåº¦ (ops/sec): ç¼“å­˜è¯»å†™æ“ä½œçš„é€Ÿåº¦
- å†…å­˜æ•ˆç‡: ç¼“å­˜æ•°æ®çš„å†…å­˜ä½¿ç”¨æ•ˆç‡

### 5. æ€§èƒ½åŸºå‡†æµ‹è¯•å’Œå›å½’æ£€æµ‹ (`benchmark.test.ts`)

å»ºç«‹æ€§èƒ½åŸºå‡†çº¿å¹¶æ£€æµ‹æ€§èƒ½å›å½’ï¼š

- **å»ºç«‹æ€§èƒ½åŸºå‡†**: ä¸ºå…³é”®åŠŸèƒ½å»ºç«‹æ€§èƒ½åŸºå‡†æ•°æ®
- **æ€§èƒ½å›å½’æ£€æµ‹**: å¯¹æ¯”å½“å‰æ€§èƒ½ä¸åŸºå‡†æ€§èƒ½
- **æ€§èƒ½æŠ¥å‘Šç”Ÿæˆ**: ç”Ÿæˆè¯¦ç»†çš„æ€§èƒ½åˆ†ææŠ¥å‘Š
- **æŒç»­æ€§èƒ½ç›‘æ§**: ç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡çš„å˜åŒ–

**åŠŸèƒ½ç‰¹æ€§**:
- è‡ªåŠ¨ä¿å­˜å’ŒåŠ è½½åŸºå‡†æ•°æ®
- æ™ºèƒ½æ£€æµ‹æ€§èƒ½å›å½’ï¼ˆé»˜è®¤é˜ˆå€¼ 20%ï¼‰
- ç”Ÿæˆ Markdown æ ¼å¼çš„æ€§èƒ½æŠ¥å‘Š
- æ”¯æŒå¤šç¯å¢ƒæ€§èƒ½å¯¹æ¯”

## ğŸ› ï¸ æ€§èƒ½æµ‹è¯•å·¥å…·

### PerformanceBenchmark ç±»

åŸºäº Benchmark.js çš„æ€§èƒ½æµ‹è¯•å·¥å…·ï¼š

```typescript
import { PerformanceBenchmark } from './setup'

const benchmark = new PerformanceBenchmark('æµ‹è¯•åç§°')

benchmark
  .add('æµ‹è¯•ç”¨ä¾‹1', () => {
    // æµ‹è¯•ä»£ç 
  })
  .add('æµ‹è¯•ç”¨ä¾‹2', () => {
    // æµ‹è¯•ä»£ç 
  })

const results = await benchmark.run()
```

### æ€§èƒ½æµ‹é‡å·¥å…·

```typescript
import { measureTime, measureTimeAsync, getMemoryUsage } from './setup'

// åŒæ­¥å‡½æ•°æ€§èƒ½æµ‹é‡
const { result, time } = measureTime(() => {
  return expensiveFunction()
})

// å¼‚æ­¥å‡½æ•°æ€§èƒ½æµ‹é‡
const { result, time } = await measureTimeAsync(async () => {
  return await expensiveAsyncFunction()
})

// å†…å­˜ä½¿ç”¨ç›‘æ§
const memory = getMemoryUsage()
console.log(`å†…å­˜ä½¿ç”¨: ${memory.used / 1024 / 1024} MB`)
```

### æ€§èƒ½ç›‘æ§å™¨

```typescript
import { performanceMonitor } from './setup'

// æ ‡è®°æ—¶é—´ç‚¹
performanceMonitor.mark('operation-start')

// æ‰§è¡Œæ“ä½œ
doSomething()

// æ ‡è®°ç»“æŸæ—¶é—´
performanceMonitor.mark('operation-end')

// æµ‹é‡æ—¶é—´å·®
const duration = performanceMonitor.measure('operation', 'operation-start', 'operation-end')
```

## ğŸ“ˆ æ€§èƒ½åŸºå‡†å’Œé˜ˆå€¼

### æ¨èæ€§èƒ½åŸºå‡†

| æ“ä½œç±»å‹ | æœ€ä½è¦æ±‚ | æ¨èå€¼ | ä¼˜ç§€å€¼ |
|---------|---------|--------|--------|
| Store å•é¡¹æ“ä½œ | 1,000 ops/sec | 5,000 ops/sec | 10,000+ ops/sec |
| å¤§åˆ—è¡¨æ¸²æŸ“ (1000é¡¹) | 5 ops/sec | 10 ops/sec | 20+ ops/sec |
| é˜²æŠ–/èŠ‚æµè°ƒç”¨ | 10,000 ops/sec | 50,000 ops/sec | 100,000+ ops/sec |
| ç¼“å­˜è¯»å– | 10,000 ops/sec | 50,000 ops/sec | 100,000+ ops/sec |
| ç¼“å­˜å†™å…¥ | 1,000 ops/sec | 5,000 ops/sec | 10,000+ ops/sec |

### å†…å­˜ä½¿ç”¨é˜ˆå€¼

| æ“ä½œç±»å‹ | å†…å­˜å¢é•¿é™åˆ¶ |
|---------|-------------|
| 1000é¡¹æ•°æ®å¤„ç† | < 10 MB |
| å¤§åˆ—è¡¨æ¸²æŸ“ | < 50 MB |
| ç¼“å­˜æ“ä½œ | < 20 MB |
| é•¿æ—¶é—´è¿è¡Œ | æ— æ˜æ˜¾å†…å­˜æ³„æ¼ |

## ğŸ”§ é…ç½®å’Œè‡ªå®šä¹‰

### ä¿®æ”¹æ€§èƒ½é˜ˆå€¼

åœ¨ `benchmark.test.ts` ä¸­ä¿®æ”¹å›å½’æ£€æµ‹é˜ˆå€¼ï¼š

```typescript
const benchmarkManager = new PerformanceBenchmarkManager(
  'performance-baseline.json', 
  0.2 // 20% æ€§èƒ½ä¸‹é™é˜ˆå€¼
)
```

### æ·»åŠ è‡ªå®šä¹‰æµ‹è¯•

1. åœ¨ç›¸åº”çš„æµ‹è¯•æ–‡ä»¶ä¸­æ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹
2. ä½¿ç”¨ `PerformanceBenchmark` ç±»åˆ›å»ºåŸºå‡†æµ‹è¯•
3. è®¾ç½®åˆé€‚çš„æ€§èƒ½æ–­è¨€
4. æ›´æ–°åŸºå‡†æ•°æ®

### ç¯å¢ƒé…ç½®

æ€§èƒ½æµ‹è¯•æ”¯æŒä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```bash
# è®¾ç½®æµ‹è¯•è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
VITEST_TIMEOUT=60000

# å¯ç”¨è¯¦ç»†è¾“å‡º
VITEST_REPORTER=verbose

# è®¾ç½®å¹¶å‘æ•°
VITEST_THREADS=1
```

## ğŸ“‹ æœ€ä½³å®è·µ

### 1. æµ‹è¯•éš”ç¦»

- æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½åº”è¯¥ç‹¬ç«‹è¿è¡Œ
- ä½¿ç”¨ `beforeEach` æ¸…ç†çŠ¶æ€
- é¿å…æµ‹è¯•ä¹‹é—´çš„ç›¸äº’å½±å“

### 2. æ€§èƒ½æ–­è¨€

- è®¾ç½®åˆç†çš„æ€§èƒ½æœŸæœ›å€¼
- è€ƒè™‘ä¸åŒç¯å¢ƒçš„æ€§èƒ½å·®å¼‚
- ä½¿ç”¨ç›¸å¯¹æ¯”è¾ƒè€Œéç»å¯¹å€¼

### 3. å†…å­˜ç›‘æ§

- å®šæœŸæ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ
- åŠæ—¶å‘ç°å†…å­˜æ³„æ¼
- éªŒè¯èµ„æºæ¸…ç†çš„æ­£ç¡®æ€§

### 4. æŒç»­ç›‘æ§

- å®šæœŸè¿è¡Œæ€§èƒ½æµ‹è¯•
- å»ºç«‹æ€§èƒ½è¶‹åŠ¿ç›‘æ§
- åŠæ—¶å‘ç°æ€§èƒ½å›å½’

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æµ‹è¯•è¶…æ—¶**: å¢åŠ  `testTimeout` é…ç½®
2. **å†…å­˜ä¸è¶³**: å‡å°‘æµ‹è¯•æ•°æ®é‡æˆ–å¢åŠ ç³»ç»Ÿå†…å­˜
3. **æ€§èƒ½æ³¢åŠ¨**: å¤šæ¬¡è¿è¡Œå–å¹³å‡å€¼ï¼Œæ’é™¤ç¯å¢ƒå¹²æ‰°
4. **åŸºå‡†æ•°æ®ç¼ºå¤±**: è¿è¡Œ `pnpm test:benchmark:baseline` å»ºç«‹åŸºå‡†

### è°ƒè¯•æŠ€å·§

1. ä½¿ç”¨ `console.log` è¾“å‡ºä¸­é—´ç»“æœ
2. åˆ©ç”¨ `performanceMonitor` å®šä½æ€§èƒ½ç“¶é¢ˆ
3. æ£€æŸ¥å†…å­˜ä½¿ç”¨è¶‹åŠ¿å›¾
4. å¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„æ€§èƒ½æ•°æ®

## ğŸ“š ç›¸å…³èµ„æº

- [Benchmark.js æ–‡æ¡£](https://benchmarkjs.com/)
- [Vitest æ€§èƒ½æµ‹è¯•æŒ‡å—](https://vitest.dev/guide/performance.html)
- [Vue 3 æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ](https://vuejs.org/guide/best-practices/performance.html)
- [Pinia æ€§èƒ½ä¼˜åŒ–](https://pinia.vuejs.org/core-concepts/state.html#performance)
